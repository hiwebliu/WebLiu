<!DOCTYPE html>
<html id="webliu" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
	<meta name="applicable-device" content="pc,mobile"/>
	<title>文章页</title>
	<link rel="stylesheet" href="css/reset.css">
	<link rel="stylesheet" href="css/font-awesome.min.css">
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/animate.min.css" />
	<link rel="stylesheet" href="css/webliu.css">
	<style>
		/*定义滚动条尺寸*/
		::-webkit-scrollbar {
			width: 4px;
			height: 4px;
		}

		::-webkit-scrollbar-thumb {
			border-radius: 10px;
			/*background-color: rgba(0, 0, 0, 0.2);*/
			background: #ffc132;
		}
	</style>
</head>
<body>
	<!-- header -->
	<div class="header">
		<div class="container">
			<section class="logo">
			<a href="#" title="logo标题" ></a>
			</section>
			<section class="search_show">
				<a href="javascript:;" class="">
					<i class="fa fa-search" data-toggle="tooltip" title="搜索"></i>
				</a>
			</section>
			<section class="site_nav">
				<ul>
					<li class="current_menu_item"><a href="#">首页</a></li>
					<li><a href="#"><i class="fa fa-wordpress"></i>WordPress相关</a></li>
					<li><a href="#"><i class="fa fa-html5"></i>前端笔记</a></li>
					<li class="menu_item_has_children"><a href="#"><i class="fa fa-gitlab"></i>主题制作</a>
						<ul class="sub_menu">
							<li><a href="#">博客</a></li>
							<li><a href="#">留言板</a></li>
							<li><a href="#">主题推荐</a></li>
							<li><a href="#">友情链接</a></li>
							<li><a href="#">归档页面</a></li>
						</ul>
					</li>
					<li><a href="#">教程</a></li>
					<li><a href="#">关于</a></li>
				</ul>
			</section>
			<section id="mobile_nav" class="mobile_nav">
				<span class="menu_top"></span>
				<span class="menu_bottom"></span>
			</section>
		</div>
	</div>

	<!-- <div class="full_screen visual"></div> -->
	<div class="single_TopWrap">
	<div class="singrgba">
	<!-- header -->
	
	<section class="article_titleWrap">
		<div class="container">
			<div class="article_title">
				<h1>wordpress教程：纯代码压缩wordpress页面html源代码实现加速</h1>
				<p class="meta">
					<span class="time"><i class="fa fa-calendar-check-o"></i>2016-12-7</span>
					<span class="author"><i class="fa fa-user-circle"></i>作者：前端刘</span>
					<span class="view"><i class="fa fa-eye"></i>浏览：15次</span>
					<span class="post_cat"><a href="#" data-toggle="tooltip" title="wordpress教程">
						<i class="fa fa-align-justify"></i>分类：wordpress教程</a>
					</span>
				</p>
			</div>
		</div>
	</section>
	</div>
	</div>
	
	<!-- ******************************************************** -->
	<div class="wrapper" style="height: 1500px">


		
		<section class="article_wrapper" style="min-height: 500px;">
			<div class="container">
				<div class="ads_articleTop wow fadeInUp" style="display: none;">
						<img src="images/1200-80.jpg"/>
				</div>
				
				<div class="article_left wow fadeInLeft" data-wow-duration="1s">
					
					<!--文章内容-->
					<section class="article_item article_content">
						<div class="breadcrumb">
							<a href="#" data-toggle="tooltip" title="前端刘"><i class="fa fa-map-marker"></i>前端刘</a> /
							<a href="#" data-toggle="tooltip" title="wordpress教程">wordpress教程</a>
						</div>




<p>本来之前WP主题网就想推荐此功能来着，后来发现与本站《<a href="http://127.0.0.1:2016/wordpress/go/?url=http://www.wpztw.com/108.html" target="_blank" rel="nofollow">wordpress教程：非插件实现wordpress代码高亮：集成prism.js</a>》功能相冲突，便就此搁浅了。之后才发现，其实把我们的高亮代码部分，不进行压缩功能就是了…于是今天推荐给大家。压缩页面html不仅能实现wordpress加速，还能让查找源码的剽窃者们费些功夫。</p> 
   <h3 id="title-0">实现方法</h3> 
   <p>编辑当前wordpress主题的functions.php文件，放入以下代码：</p> 
   <pre class="line-numbers  language-javascript"><code class=" language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">$</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">scroll</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">scrollTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">//距顶部多少像素时，出现返回顶部按钮
</span>				<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;.gotop&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fadeIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span><span class="token punctuation">{</span>
				<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;.gotop&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;.gotop&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'html,body'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'scrollTop'</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//返回顶部动画 数值越小时间越短
</span>		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> 
   <pre class="line-numbers language-css"><code class=" language-css"><span class="token selector">.line-numbers-rows &gt; span </span><span class="token punctuation">{</span>
  <span class="token property">pointer-events</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span>block<span class="token punctuation">;</span>
  <span class="token property">counter-increment</span><span class="token punctuation">:</span>linenumber
<span class="token punctuation">}</span><span class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre> 
   <p>1111</p> 
   <pre class="line-numbers  language-php"><code class=" language-php">timthumb<span class="token punctuation">.</span>php文件中的define <span class="token punctuation">(</span>‘<span class="token constant">ALLOW_ALL_EXTERNAL_SITES</span>’<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>将它替换为：define <span class="token punctuation">(</span>‘<span class="token constant">ALLOW_ALL_EXTERNAL_SITES</span>’<span class="token punctuation">,</span> <span class="token constant">TRUE</span><span class="token punctuation">)</span><span class="line-numbers-rows"><span></span></span></code></pre> 
   <p>111</p> 
   <pre class="line-numbers  language-php"><code class=" language-php"><span class="token keyword">function</span> <span class="token function">wp_compress_html<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">function</span> wp_compress_html_main <span class="token punctuation">(</span><span class="token variable">$buffer</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$initial</span><span class="token operator">=</span><span class="token function">strlen<span class="token punctuation">(</span></span><span class="token variable">$buffer</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$buffer</span><span class="token operator">=</span><span class="token function">explode<span class="token punctuation">(</span></span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token variable">$buffer</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$count</span><span class="token operator">=</span>count <span class="token punctuation">(</span><span class="token variable">$buffer</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;=</span> <span class="token variable">$count</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">stristr<span class="token punctuation">(</span></span><span class="token variable">$buffer</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$buffer</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token function">str_replace<span class="token punctuation">(</span></span><span class="token string">&quot; &quot;</span><span class="token punctuation">,</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">,</span> <span class="token variable">$buffer</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token variable">$buffer</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token function">str_replace<span class="token punctuation">(</span></span><span class="token string">&quot;\t&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">,</span> <span class="token variable">$buffer</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$buffer</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token function">str_replace<span class="token punctuation">(</span></span><span class="token string">&quot;\n\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">,</span> <span class="token variable">$buffer</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$buffer</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token function">str_replace<span class="token punctuation">(</span></span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token variable">$buffer</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$buffer</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token function">str_replace<span class="token punctuation">(</span></span><span class="token string">&quot;\r&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token variable">$buffer</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">stristr<span class="token punctuation">(</span></span><span class="token variable">$buffer</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'  '</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$buffer</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token function">str_replace<span class="token punctuation">(</span></span><span class="token string">&quot;  &quot;</span><span class="token punctuation">,</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">,</span> <span class="token variable">$buffer</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token variable">$buffer_out</span><span class="token punctuation">.</span><span class="token operator">=</span><span class="token variable">$buffer</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token variable">$buffer_out</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">ob_start<span class="token punctuation">(</span></span><span class="token string">&quot;wp_compress_html_main&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">add_action<span class="token punctuation">(</span></span><span class="token string">'get_header'</span><span class="token punctuation">,</span> <span class="token string">'wp_compress_html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> 
   <h3 id="title-1">防止压缩</h3> 
   <p>因为我们wordpress主题集成的高亮功能是放在标签<em>&lt;pre&gt;</em>之内的，所以我们把标签内的代码禁止压缩即可。</p> 
   <pre class="line-numbers  language-javascript"><code class=" language-javascript"><span class="token keyword">function</span> <span class="token function">unCompress</span><span class="token punctuation">(</span>$content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match_all</span><span class="token punctuation">(</span><span class="token string">'/(crayon-|&lt;\/pre&gt;)/i'</span><span class="token punctuation">,</span> $content<span class="token punctuation">,</span> $matches<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        $content <span class="token operator">=</span> <span class="token string">' '</span><span class="token punctuation">.</span>$content<span class="token punctuation">;</span>
        $content<span class="token punctuation">.</span><span class="token operator">=</span> <span class="token string">' '</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> $content<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">add_filter</span><span class="token punctuation">(</span> <span class="token string">&quot;the_content&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;unCompress&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> 
   <h3 id="title-2">下面是php代码</h3> 
   <pre class="line-numbers  language-php"><code class=" language-php"><span class="token comment" spellcheck="true">// 将所有分类（categories）加入数组
</span><span class="token variable">$options_categories</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$options_categories_obj</span> <span class="token operator">=</span> <span class="token function">get_categories<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$options_categories_obj</span> <span class="token keyword">as</span> <span class="token variable">$category</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token variable">$options_categories</span><span class="token punctuation">[</span><span class="token variable">$category</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">cat_ID</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$category</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">cat_name</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> 
   <div class="post_function"> 
    <div class="cl"></div> 
   </div> 














						
						<p class="article_tags">
						<span class="webliuicon"><i class="fa fa-tags"></i>标签：</span>
						<a href="#">wordpress教程</a><a href="#">wordpress加速</a><a href="#">代码压缩</a>
				</p>
					</section>
					
					<!--相关文章-->
					<section class="article_item article-related">
						<h3><i class="fa fa-object-ungroup"></i>相关文章</h3>
						<ul>
							<li><a href="#">jquery从入门到放弃</a></li>
							<li><a href="#">代码实现文章高亮功能</a></li>
						</ul>
					</section>
				</div>
				
				<aside class="sidebar">
					<section class="user_sidebar">
						<p class="user_img">
							<a href="#" title="前端刘"><img src="img/timg.png"></a>
						</p>
						<p class="user_name">
							<a href="#">前端刘</a>
							<i class="fa fa-vimeo-square" data-toggle="tooltip" title="站长"></i>
							<i class="fa fa-html5" data-toggle="tooltip" title="前端工程师"></i>
							<i class="fa fa-lastfm-square" data-toggle="tooltip" title="C#后端开发"></i>
						</p>
						<p class="user_introduce">人生天地之间，若白驹之过隙，忽然而已</p>
					</section>
				</aside>
			</div>
		</section>

	</div><!--wrapper end-->
	

</body>
<script src="js/jquery-3.3.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/wow.min.js"></script>
<script src="js/main.js"></script>
</body>
</html>